<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Halaman Detail Tiket - Bahasa Indonesia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #2563eb;
            margin-top: 0;
        }
        .button {
            background: #2563eb;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #1d4ed8;
        }
        .button.secondary {
            background: #6b7280;
        }
        .button.secondary:hover {
            background: #4b5563;
        }
        .button.danger {
            background: #dc2626;
        }
        .button.danger:hover {
            background: #b91c1c;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.escalated {
            background: #fef3c7;
            color: #92400e;
        }
        .status.resolved {
            background: #d1fae5;
            color: #065f46;
        }
        .status.in_progress {
            background: #dbeafe;
            color: #1e40af;
        }
        .log {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .success {
            color: #059669;
            font-weight: bold;
        }
        .error {
            color: #dc2626;
            font-weight: bold;
        }
        .info {
            color: #2563eb;
        }
        .ticket-info {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ« Test Halaman Detail Tiket - Bahasa Indonesia</h1>
        <p>Test untuk memastikan semua tombol dan fungsi pada halaman detail tiket berfungsi dengan baik dalam bahasa Indonesia.</p>

        <!-- Informasi Tiket -->
        <div class="ticket-info">
            <h3>ğŸ“‹ Informasi Tiket Test</h3>
            <p><strong>ID:</strong> 990e8400-e29b-41d4-a716-446655440001</p>
            <p><strong>Nomor Tiket:</strong> TKT-2024-0001</p>
            <p><strong>Judul:</strong> Antrian Pelayanan Terlalu Lama</p>
            <p><strong>Status:</strong> <span class="status escalated">Dieskalasi</span></p>
            <p><strong>Unit:</strong> Sub Bagian Informasi</p>
            <p><strong>Pelapor:</strong> Budi Santoso</p>
        </div>

        <!-- Test Tombol Selesaikan -->
        <div class="test-section">
            <h3>âœ… Test Tombol "Selesaikan"</h3>
            <p>Tombol ini akan mengubah status tiket menjadi "resolved" dan menambahkan timestamp resolved_at.</p>
            <button class="button" onclick="testResolveTicket()">ğŸ¯ Selesaikan Tiket</button>
            <div id="resolveLog" class="log"></div>
        </div>

        <!-- Test Tombol Eskalasi -->
        <div class="test-section">
            <h3>âš ï¸ Test Tombol "Eskalasi"</h3>
            <p>Tombol ini akan mengubah status tiket menjadi "escalated" dan mencatat log eskalasi.</p>
            <button class="button secondary" onclick="testEscalateTicket()">ğŸ“ˆ Eskalasi Tiket</button>
            <div id="escalateLog" class="log"></div>
        </div>

        <!-- Test Tombol Tugaskan -->
        <div class="test-section">
            <h3>ğŸ‘¤ Test Tombol "Tugaskan"</h3>
            <p>Tombol ini akan membuka modal untuk menugaskan tiket kepada pengguna tertentu.</p>
            <button class="button" onclick="showAssignModal()">ğŸ‘¥ Tugaskan Tiket</button>
            <div id="assignLog" class="log"></div>
        </div>

        <!-- Test Kirim Balasan -->
        <div class="test-section">
            <h3>ğŸ’¬ Test "Kirim Balasan"</h3>
            <p>Fungsi ini akan menambahkan balasan baru ke tiket dan memperbarui status jika diperlukan.</p>
            <div class="form-group">
                <label for="replyText">Balasan:</label>
                <textarea id="replyText" placeholder="Ketik balasan Anda di sini..."></textarea>
            </div>
            <button class="button" onclick="testSendReply(false)">ğŸ“¤ Kirim Balasan</button>
            <button class="button secondary" onclick="testSendReply(true)">ğŸ“ Kirim Catatan Internal</button>
            <div id="replyLog" class="log"></div>
        </div>

        <!-- Test Integrasi Database -->
        <div class="test-section">
            <h3>ğŸ—„ï¸ Test Integrasi Database</h3>
            <p>Test koneksi dan operasi database untuk memastikan semua fungsi terintegrasi dengan baik.</p>
            <button class="button" onclick="testDatabaseConnection()">ğŸ”— Test Koneksi Database</button>
            <button class="button secondary" onclick="testFetchTicketData()">ğŸ“Š Ambil Data Tiket</button>
            <button class="button secondary" onclick="testFetchUsers()">ğŸ‘¥ Ambil Data Pengguna</button>
            <div id="dbLog" class="log"></div>
        </div>

        <!-- Test Bahasa Indonesia -->
        <div class="test-section">
            <h3>ğŸ‡®ğŸ‡© Test Bahasa Indonesia</h3>
            <p>Memastikan semua teks telah diubah ke bahasa Indonesia dengan benar.</p>
            <button class="button" onclick="testIndonesianTexts()">ğŸ”¤ Periksa Teks Bahasa Indonesia</button>
            <div id="languageLog" class="log"></div>
        </div>
    </div>

    <!-- Modal Tugaskan -->
    <div id="assignModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ‘¥ Tugaskan Tiket</h3>
            <div class="form-group">
                <label for="userSelect">Pilih Pengguna:</label>
                <select id="userSelect">
                    <option value="">-- Pilih Pengguna --</option>
                    <option value="770e8400-e29b-41d4-a716-446655440001">Dr. Ahmad Direktur (director)</option>
                    <option value="770e8400-e29b-41d4-a716-446655440002">Siti Manager Pelayanan (manager)</option>
                    <option value="770e8400-e29b-41d4-a716-446655440003">Budi Supervisor Info (supervisor)</option>
                    <option value="770e8400-e29b-41d4-a716-446655440004">Rina Staff Pengaduan (staff)</option>
                </select>
            </div>
            <div style="text-align: right;">
                <button class="button secondary" onclick="hideAssignModal()">âŒ Batal</button>
                <button class="button" onclick="testAssignTicket()">âœ… Tugaskan</button>
            </div>
        </div>
    </div>

    <script>
        const TICKET_ID = '990e8400-e29b-41d4-a716-446655440001';
        const API_BASE = 'http://localhost:3001/api';

        function log(elementId, message, type = 'info') {
            const logElement = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString('id-ID');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logElement.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        async function testResolveTicket() {
            log('resolveLog', 'ğŸ¯ Memulai test tombol Selesaikan...');
            
            if (!confirm('Apakah Anda yakin ingin menyelesaikan tiket ini?')) {
                log('resolveLog', 'âŒ Test dibatalkan oleh pengguna', 'error');
                return;
            }

            try {
                log('resolveLog', 'ğŸ“¡ Mengirim request untuk menyelesaikan tiket...');
                
                // Simulasi API call untuk resolve ticket
                const response = await fetch(`${API_BASE}/tickets/${TICKET_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        status: 'resolved',
                        resolved_at: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    log('resolveLog', 'âœ… Tiket berhasil diselesaikan!', 'success');
                    log('resolveLog', 'ğŸ“ Status diubah menjadi "resolved"');
                    log('resolveLog', 'â° Timestamp resolved_at ditambahkan');
                    
                    // Simulasi menambah system response
                    log('resolveLog', 'ğŸ’¬ Menambahkan balasan sistem...');
                    setTimeout(() => {
                        log('resolveLog', 'âœ… Balasan sistem berhasil ditambahkan', 'success');
                    }, 500);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log('resolveLog', `âŒ Gagal menyelesaikan tiket: ${error.message}`, 'error');
                log('resolveLog', 'ğŸ”§ Periksa koneksi database dan API endpoint');
            }
        }

        async function testEscalateTicket() {
            log('escalateLog', 'ğŸ“ˆ Memulai test tombol Eskalasi...');
            
            if (!confirm('Apakah Anda yakin ingin melakukan eskalasi tiket ini?')) {
                log('escalateLog', 'âŒ Test dibatalkan oleh pengguna', 'error');
                return;
            }

            try {
                log('escalateLog', 'ğŸ“¡ Mengirim request untuk eskalasi tiket...');
                
                // Simulasi API call untuk escalate ticket
                const response = await fetch(`${API_BASE}/tickets/${TICKET_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        status: 'escalated'
                    })
                });

                if (response.ok) {
                    log('escalateLog', 'âœ… Tiket berhasil dieskalasi!', 'success');
                    log('escalateLog', 'ğŸ“ Status diubah menjadi "escalated"');
                    
                    // Simulasi menambah escalation log
                    log('escalateLog', 'ğŸ“Š Menambahkan log eskalasi...');
                    setTimeout(() => {
                        log('escalateLog', 'âœ… Log eskalasi berhasil ditambahkan', 'success');
                        log('escalateLog', 'ğŸ‘¤ From: staff â†’ To: supervisor');
                    }, 500);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log('escalateLog', `âŒ Gagal melakukan eskalasi: ${error.message}`, 'error');
                log('escalateLog', 'ğŸ”§ Periksa koneksi database dan API endpoint');
            }
        }

        function showAssignModal() {
            log('assignLog', 'ğŸ‘¥ Membuka modal tugaskan tiket...');
            document.getElementById('assignModal').style.display = 'block';
        }

        function hideAssignModal() {
            log('assignLog', 'âŒ Modal tugaskan ditutup');
            document.getElementById('assignModal').style.display = 'none';
            document.getElementById('userSelect').value = '';
        }

        async function testAssignTicket() {
            const selectedUserId = document.getElementById('userSelect').value;
            
            if (!selectedUserId) {
                log('assignLog', 'âŒ Pilih pengguna terlebih dahulu', 'error');
                return;
            }

            log('assignLog', 'ğŸ‘¤ Memulai test tugaskan tiket...');

            try {
                log('assignLog', 'ğŸ“¡ Mengirim request untuk menugaskan tiket...');
                
                // Simulasi API call untuk assign ticket
                const response = await fetch(`${API_BASE}/tickets/${TICKET_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        assigned_to: selectedUserId,
                        status: 'in_progress'
                    })
                });

                if (response.ok) {
                    const selectedOption = document.getElementById('userSelect').selectedOptions[0];
                    const userName = selectedOption.text;
                    
                    log('assignLog', 'âœ… Tiket berhasil ditugaskan!', 'success');
                    log('assignLog', `ğŸ‘¤ Ditugaskan kepada: ${userName}`);
                    log('assignLog', 'ğŸ“ Status diubah menjadi "in_progress"');
                    
                    hideAssignModal();
                    
                    // Simulasi menambah system response
                    setTimeout(() => {
                        log('assignLog', 'ğŸ’¬ Balasan sistem berhasil ditambahkan', 'success');
                    }, 500);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log('assignLog', `âŒ Gagal menugaskan tiket: ${error.message}`, 'error');
                log('assignLog', 'ğŸ”§ Periksa koneksi database dan API endpoint');
            }
        }

        async function testSendReply(isInternal) {
            const replyText = document.getElementById('replyText').value.trim();
            
            if (!replyText) {
                log('replyLog', 'âŒ Masukkan teks balasan terlebih dahulu', 'error');
                return;
            }

            const replyType = isInternal ? 'catatan internal' : 'balasan';
            log('replyLog', `ğŸ’¬ Memulai test kirim ${replyType}...`);

            try {
                log('replyLog', `ğŸ“¡ Mengirim ${replyType}...`);
                
                // Simulasi API call untuk send reply
                const response = await fetch(`${API_BASE}/ticket-responses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ticket_id: TICKET_ID,
                        message: replyText,
                        response_type: isInternal ? 'comment' : 'resolution',
                        is_internal: isInternal
                    })
                });

                if (response.ok) {
                    log('replyLog', `âœ… ${replyType.charAt(0).toUpperCase() + replyType.slice(1)} berhasil dikirim!`, 'success');
                    log('replyLog', `ğŸ“ Tipe: ${isInternal ? 'Internal' : 'Publik'}`);
                    log('replyLog', `ğŸ’¬ Pesan: "${replyText}"`);
                    
                    // Clear textarea
                    document.getElementById('replyText').value = '';
                    
                    // Simulasi update first_response_at jika belum ada
                    setTimeout(() => {
                        log('replyLog', 'â° first_response_at diperbarui (jika belum ada)', 'success');
                    }, 300);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log('replyLog', `âŒ Gagal mengirim ${replyType}: ${error.message}`, 'error');
                log('replyLog', 'ğŸ”§ Periksa koneksi database dan API endpoint');
            }
        }

        async function testDatabaseConnection() {
            log('dbLog', 'ğŸ”— Testing koneksi database...');
            
            try {
                log('dbLog', 'ğŸ“¡ Mengirim ping ke API...');
                const response = await fetch(`${API_BASE}/health`);
                
                if (response.ok) {
                    log('dbLog', 'âœ… Koneksi database berhasil!', 'success');
                    log('dbLog', 'ğŸ—„ï¸ API endpoint dapat diakses');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log('dbLog', `âŒ Koneksi database gagal: ${error.message}`, 'error');
                log('dbLog', 'ğŸ”§ Pastikan backend server berjalan di port 3001');
            }
        }

        async function testFetchTicketData() {
            log('dbLog', 'ğŸ“Š Mengambil data tiket...');
            
            try {
                log('dbLog', `ğŸ“¡ Fetching tiket ID: ${TICKET_ID}`);
                const response = await fetch(`${API_BASE}/tickets/${TICKET_ID}`);
                
                if (response.ok) {
                    const ticket = await response.json();
                    log('dbLog', 'âœ… Data tiket berhasil diambil!', 'success');
                    log('dbLog', `ğŸ“‹ Nomor: ${ticket.ticket_number}`);
                    log('dbLog', `ğŸ“ Judul: ${ticket.title}`);
                    log('dbLog', `ğŸ·ï¸ Status: ${ticket.status}`);
                    log('dbLog', `ğŸ‘¤ Pelapor: ${ticket.submitter_name}`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log('dbLog', `âŒ Gagal mengambil data tiket: ${error.message}`, 'error');
                log('dbLog', 'ğŸ”§ Periksa endpoint API dan database');
            }
        }

        async function testFetchUsers() {
            log('dbLog', 'ğŸ‘¥ Mengambil data pengguna...');
            
            try {
                log('dbLog', 'ğŸ“¡ Fetching daftar pengguna aktif...');
                const response = await fetch(`${API_BASE}/users?is_active=true`);
                
                if (response.ok) {
                    const users = await response.json();
                    log('dbLog', 'âœ… Data pengguna berhasil diambil!', 'success');
                    log('dbLog', `ğŸ‘¥ Total pengguna aktif: ${users.length}`);
                    
                    users.slice(0, 3).forEach(user => {
                        log('dbLog', `ğŸ‘¤ ${user.full_name} (${user.role})`);
                    });
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log('dbLog', `âŒ Gagal mengambil data pengguna: ${error.message}`, 'error');
                log('dbLog', 'ğŸ”§ Periksa endpoint API dan tabel users');
            }
        }

        function testIndonesianTexts() {
            log('languageLog', 'ğŸ‡®ğŸ‡© Memeriksa teks bahasa Indonesia...');
            
            const indonesianTexts = [
                'Selesaikan',
                'Eskalasi', 
                'Tugaskan',
                'Kirim Balasan',
                'Detail Tiket',
                'Riwayat Aktivitas',
                'Analisis & Wawasan AI',
                'Sentimen Pelanggan',
                'Info Pelapor',
                'Timer SLA',
                'Prioritas',
                'Deskripsi'
            ];
            
            log('languageLog', 'âœ… Teks bahasa Indonesia yang diimplementasi:', 'success');
            indonesianTexts.forEach(text => {
                log('languageLog', `âœ“ "${text}"`);
            });
            
            log('languageLog', 'ğŸ”¤ Semua teks utama telah diubah ke bahasa Indonesia', 'success');
            log('languageLog', 'ğŸ“… Format tanggal menggunakan locale Indonesia (id-ID)');
            log('languageLog', 'ğŸ’¬ Pesan konfirmasi dan alert dalam bahasa Indonesia');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            log('dbLog', 'ğŸš€ Halaman test siap digunakan');
            log('languageLog', 'ğŸ‡®ğŸ‡© Interface dalam bahasa Indonesia');
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('assignModal');
            if (event.target === modal) {
                hideAssignModal();
            }
        }
    </script>
</body>
</html>