<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Vercel Endpoints</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Test Vercel API Endpoints</h1>
    <p>Test semua endpoint API public untuk form tiket internal dan survey</p>

    <!-- Test 1: Get Units -->
    <div class="test-section">
        <h2>1. Test GET /api/public/units</h2>
        <p>Mengambil daftar unit yang aktif</p>
        <button onclick="testGetUnits()">Test Get Units</button>
        <div id="result-units" class="result" style="display:none;"></div>
    </div>

    <!-- Test 2: Get App Settings -->
    <div class="test-section">
        <h2>2. Test GET /api/public/app-settings</h2>
        <p>Mengambil pengaturan aplikasi untuk footer</p>
        <button onclick="testGetAppSettings()">Test Get App Settings</button>
        <div id="result-settings" class="result" style="display:none;"></div>
    </div>

    <!-- Test 3: Submit Internal Ticket -->
    <div class="test-section">
        <h2>3. Test POST /api/public/internal-tickets</h2>
        <p>Submit tiket internal</p>
        
        <label>Unit ID:</label>
        <input type="text" id="internal-unit-id" placeholder="Masukkan unit_id dari hasil test 1">
        
        <label>Nama Pelapor:</label>
        <input type="text" id="internal-name" value="Test User" placeholder="Nama lengkap">
        
        <label>Email:</label>
        <input type="email" id="internal-email" value="test@example.com" placeholder="Email">
        
        <label>Judul:</label>
        <input type="text" id="internal-title" value="Test Tiket Internal" placeholder="Judul tiket">
        
        <label>Deskripsi:</label>
        <textarea id="internal-desc" rows="3" placeholder="Deskripsi masalah">Test deskripsi tiket internal dari Vercel</textarea>
        
        <button onclick="testSubmitInternalTicket()">Submit Internal Ticket</button>
        <div id="result-internal" class="result" style="display:none;"></div>
    </div>

    <!-- Test 4: Submit Survey -->
    <div class="test-section">
        <h2>4. Test POST /api/public/surveys</h2>
        <p>Submit survey kepuasan</p>
        
        <label>Unit ID:</label>
        <input type="text" id="survey-unit-id" placeholder="Masukkan unit_id dari hasil test 1">
        
        <label>Nomor HP:</label>
        <input type="tel" id="survey-phone" value="081234567890" placeholder="08xxxxxxxxxx">
        
        <label>Nama (opsional):</label>
        <input type="text" id="survey-name" value="Test Responden" placeholder="Nama lengkap">
        
        <button onclick="testSubmitSurvey()">Submit Survey</button>
        <div id="result-survey" class="result" style="display:none;"></div>
    </div>

    <!-- Test 5: Submit External Ticket -->
    <div class="test-section">
        <h2>5. Test POST /api/public/external-tickets</h2>
        <p>Submit tiket eksternal (pengaduan)</p>
        
        <label>Unit ID:</label>
        <input type="text" id="external-unit-id" placeholder="Masukkan unit_id dari hasil test 1">
        
        <label>Nama Pelapor:</label>
        <input type="text" id="external-name" value="Test Pengadu" placeholder="Nama lengkap">
        
        <label>Email:</label>
        <input type="email" id="external-email" value="pengadu@example.com" placeholder="Email">
        
        <label>Judul:</label>
        <input type="text" id="external-title" value="Test Pengaduan" placeholder="Judul pengaduan">
        
        <label>Deskripsi:</label>
        <textarea id="external-desc" rows="3" placeholder="Deskripsi pengaduan">Test deskripsi pengaduan dari Vercel</textarea>
        
        <button onclick="testSubmitExternalTicket()">Submit External Ticket</button>
        <div id="result-external" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        function showResult(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.className = 'result ' + (isError ? 'error' : 'success');
            el.textContent = JSON.stringify(data, null, 2);
        }

        function showInfo(elementId, message) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.className = 'result info';
            el.textContent = message;
        }

        async function testGetUnits() {
            showInfo('result-units', 'Loading...');
            try {
                const response = await fetch(`${API_BASE}/api/public/units`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('result-units', {
                        status: response.status,
                        message: `âœ… Berhasil! Ditemukan ${data.data.length} unit`,
                        data: data.data
                    });
                } else {
                    showResult('result-units', {
                        status: response.status,
                        error: data.error || 'Unknown error'
                    }, true);
                }
            } catch (error) {
                showResult('result-units', {
                    error: error.message
                }, true);
            }
        }

        async function testGetAppSettings() {
            showInfo('result-settings', 'Loading...');
            try {
                const response = await fetch(`${API_BASE}/api/public/app-settings`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('result-settings', {
                        status: response.status,
                        message: 'âœ… Berhasil!',
                        data: data.data
                    });
                } else {
                    showResult('result-settings', {
                        status: response.status,
                        error: data.error || 'Unknown error'
                    }, true);
                }
            } catch (error) {
                showResult('result-settings', {
                    error: error.message
                }, true);
            }
        }

        async function testSubmitInternalTicket() {
            showInfo('result-internal', 'Submitting...');
            
            const unitId = document.getElementById('internal-unit-id').value;
            const name = document.getElementById('internal-name').value;
            const email = document.getElementById('internal-email').value;
            const title = document.getElementById('internal-title').value;
            const description = document.getElementById('internal-desc').value;

            if (!unitId || !name || !email || !title || !description) {
                showResult('result-internal', {
                    error: 'Semua field harus diisi!'
                }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/public/internal-tickets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        unit_id: unitId,
                        reporter_name: name,
                        reporter_email: email,
                        reporter_phone: '081234567890',
                        reporter_department: 'Test Department',
                        reporter_position: 'Test Position',
                        category: 'it_support',
                        priority: 'medium',
                        title: title,
                        description: description,
                        source: 'web'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('result-internal', {
                        status: response.status,
                        message: 'âœ… Tiket berhasil dibuat!',
                        ticket_number: data.ticket_number,
                        data: data.data
                    });
                } else {
                    showResult('result-internal', {
                        status: response.status,
                        error: data.error || 'Unknown error',
                        details: data.details
                    }, true);
                }
            } catch (error) {
                showResult('result-internal', {
                    error: error.message
                }, true);
            }
        }

        async function testSubmitSurvey() {
            showInfo('result-survey', 'Submitting...');
            
            const unitId = document.getElementById('survey-unit-id').value;
            const phone = document.getElementById('survey-phone').value;
            const name = document.getElementById('survey-name').value;

            if (!unitId || !phone) {
                showResult('result-survey', {
                    error: 'Unit ID dan Nomor HP harus diisi!'
                }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/public/surveys`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        unit_id: unitId,
                        visitor_name: name,
                        visitor_phone: phone,
                        is_anonymous: false,
                        age_range: '20-40 Th',
                        gender: 'male',
                        service_type: 'rawat_jalan',
                        u1_ind1_score: 4,
                        u1_ind2_score: 4,
                        u1_ind3_score: 5,
                        overall_score: 4,
                        comments: 'Test survey dari Vercel',
                        source: 'public_survey'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('result-survey', {
                        status: response.status,
                        message: 'âœ… Survey berhasil dikirim!',
                        data: data.data
                    });
                } else {
                    showResult('result-survey', {
                        status: response.status,
                        error: data.error || 'Unknown error'
                    }, true);
                }
            } catch (error) {
                showResult('result-survey', {
                    error: error.message
                }, true);
            }
        }

        async function testSubmitExternalTicket() {
            showInfo('result-external', 'Submitting...');
            
            const unitId = document.getElementById('external-unit-id').value;
            const name = document.getElementById('external-name').value;
            const email = document.getElementById('external-email').value;
            const title = document.getElementById('external-title').value;
            const description = document.getElementById('external-desc').value;

            if (!unitId || !title || !description) {
                showResult('result-external', {
                    error: 'Unit ID, Judul, dan Deskripsi harus diisi!'
                }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/public/external-tickets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        unit_id: unitId,
                        reporter_identity_type: 'known',
                        reporter_name: name,
                        reporter_email: email,
                        reporter_phone: '081234567890',
                        service_type: 'complaint',
                        title: title,
                        description: description,
                        source: 'web'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('result-external', {
                        status: response.status,
                        message: 'âœ… Tiket berhasil dibuat!',
                        ticket_number: data.ticket_number,
                        data: data.data
                    });
                } else {
                    showResult('result-external', {
                        status: response.status,
                        error: data.error || 'Unknown error',
                        details: data.details
                    }, true);
                }
            } catch (error) {
                showResult('result-external', {
                    error: error.message
                }, true);
            }
        }

        // Auto-fill unit_id when units are loaded
        window.addEventListener('load', () => {
            console.log('Test page loaded. Click "Test Get Units" first to get unit IDs.');
        });
    </script>
</body>
</html>
