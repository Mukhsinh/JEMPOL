<!DOCTYPE html>
<html>
<head>
    <title>Test Login Simple</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h2>Test Login</h2>
    <div id="result"></div>
    
    <script>
        const supabaseUrl = 'https://jxxzbdivafzzwqhagwrf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4eHpiZGl2YWZ6endxaGFnd3JmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MTkwNTEsImV4cCI6MjA4MDQ5NTA1MX0.ICOtGuxrD19GtawdR9JAsnFn9XsHxWkr1aHCEkgHqXg';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        async function testLogin() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>üîÑ Testing login...</p>';
            
            try {
                // Clear session dulu
                await supabase.auth.signOut();
                console.log('‚úÖ Session cleared');
                
                // Test dengan kredensial yang berbeda
                const testAccounts = [
                    { email: 'admin@jempol.com', password: 'admin123' },
                    { email: 'admin@jempol.com', password: 'Admin123!' },
                    { email: 'mukhsin9@gmail.com', password: 'admin123' }
                ];
                
                for (const account of testAccounts) {
                    console.log(`\nüß™ Testing: ${account.email}`);
                    resultDiv.innerHTML += `<p>üß™ Testing: ${account.email}</p>`;
                    
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: account.email,
                        password: account.password
                    });
                    
                    if (error) {
                        console.error('‚ùå Error:', error.message);
                        resultDiv.innerHTML += `<p style="color: red;">‚ùå ${account.email}: ${error.message}</p>`;
                    } else {
                        console.log('‚úÖ Login berhasil!');
                        console.log('User:', data.user.email);
                        resultDiv.innerHTML += `<p style="color: green;">‚úÖ ${account.email}: LOGIN BERHASIL!</p>`;
                        
                        // Cek admin profile
                        const { data: adminData, error: adminError } = await supabase
                            .from('admins')
                            .select('*')
                            .eq('email', account.email)
                            .single();
                        
                        if (adminError) {
                            console.error('‚ùå Admin profile error:', adminError);
                            resultDiv.innerHTML += `<p style="color: orange;">‚ö†Ô∏è Admin profile error: ${adminError.message}</p>`;
                        } else {
                            console.log('‚úÖ Admin profile:', adminData);
                            resultDiv.innerHTML += `<p style="color: green;">‚úÖ Admin: ${adminData.username} (${adminData.role})</p>`;
                        }
                        
                        // Logout setelah test berhasil
                        await supabase.auth.signOut();
                        break; // Keluar dari loop jika berhasil
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Unexpected error:', error);
                resultDiv.innerHTML += `<p style="color: red;">‚ùå Unexpected error: ${error.message}</p>`;
            }
        }
        
        // Auto run test
        testLogin();
    </script>
</body>
</html>
