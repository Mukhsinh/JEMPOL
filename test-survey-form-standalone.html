<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Survey Form Standalone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-8">
        <div class="max-w-4xl mx-auto px-4">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-8 text-center">
                    Test Survey Form Standalone
                </h1>

                <!-- Test API Endpoints -->
                <div class="mb-8 space-y-4">
                    <h2 class="text-xl font-semibold text-gray-800">Test API Endpoints</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="testUnitsAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                            Test Units API
                        </button>
                        <button onclick="testServiceCategoriesAPI()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                            Test Service Categories API
                        </button>
                        <button onclick="testSurveySubmission()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                            Test Survey Submission
                        </button>
                    </div>
                </div>

                <!-- Survey Form -->
                <form id="surveyForm" class="space-y-6">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-gray-900">Survei Kepuasan Layanan</h2>
                        <p class="text-gray-600 mt-2">Berikan penilaian terhadap layanan yang Anda terima</p>
                    </div>

                    <!-- Service Information -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Informasi Layanan</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Unit/Bagian <span class="text-red-500">*</span>
                                </label>
                                <select id="unit_id" name="unit_id" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Unit/Bagian</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Kategori Layanan <span class="text-red-500">*</span>
                                </label>
                                <select id="service_category_id" name="service_category_id" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Kategori Layanan</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Deskripsi Layanan <span class="text-red-500">*</span>
                            </label>
                            <textarea id="service_description" name="service_description" required rows="3" 
                                placeholder="Jelaskan layanan yang Anda terima..."
                                class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Reporter Information -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Informasi Pelapor (Opsional)</h3>
                        
                        <div class="mb-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="is_anonymous" name="is_anonymous" class="mr-2">
                                <span class="text-sm text-gray-700">Kirim survei secara anonim</span>
                            </label>
                        </div>

                        <div id="reporterFields" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" id="reporter_name" name="reporter_name" 
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="reporter_email" name="reporter_email" 
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Telepon</label>
                                <input type="tel" id="reporter_phone" name="reporter_phone" 
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Rating Questions -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Penilaian Layanan</h3>
                        <p class="text-sm text-gray-600 mb-6">Beri penilaian dari 1 (Sangat Buruk) hingga 5 (Sangat Baik)</p>
                        
                        <div class="space-y-6">
                            <!-- Overall Score -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    Penilaian Keseluruhan
                                </label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-xs text-gray-500">1</span>
                                    <div class="flex space-x-2">
                                        <input type="radio" name="overall_score" value="1" id="overall_1" class="hidden">
                                        <label for="overall_1" class="cursor-pointer text-2xl hover:text-red-500">üòû</label>
                                        <input type="radio" name="overall_score" value="2" id="overall_2" class="hidden">
                                        <label for="overall_2" class="cursor-pointer text-2xl hover:text-orange-500">üòê</label>
                                        <input type="radio" name="overall_score" value="3" id="overall_3" class="hidden">
                                        <label for="overall_3" class="cursor-pointer text-2xl hover:text-yellow-500">üòä</label>
                                        <input type="radio" name="overall_score" value="4" id="overall_4" class="hidden">
                                        <label for="overall_4" class="cursor-pointer text-2xl hover:text-lime-500">üòÑ</label>
                                        <input type="radio" name="overall_score" value="5" id="overall_5" class="hidden">
                                        <label for="overall_5" class="cursor-pointer text-2xl hover:text-green-500">üòç</label>
                                    </div>
                                    <span class="text-xs text-gray-500">5</span>
                                </div>
                            </div>

                            <!-- Response Time Score -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    Kecepatan Respon
                                </label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-xs text-gray-500">1</span>
                                    <div class="flex space-x-2">
                                        <input type="radio" name="response_time_score" value="1" id="response_1" class="hidden">
                                        <label for="response_1" class="cursor-pointer text-2xl hover:text-red-500">üòû</label>
                                        <input type="radio" name="response_time_score" value="2" id="response_2" class="hidden">
                                        <label for="response_2" class="cursor-pointer text-2xl hover:text-orange-500">üòê</label>
                                        <input type="radio" name="response_time_score" value="3" id="response_3" class="hidden">
                                        <label for="response_3" class="cursor-pointer text-2xl hover:text-yellow-500">üòä</label>
                                        <input type="radio" name="response_time_score" value="4" id="response_4" class="hidden">
                                        <label for="response_4" class="cursor-pointer text-2xl hover:text-lime-500">üòÑ</label>
                                        <input type="radio" name="response_time_score" value="5" id="response_5" class="hidden">
                                        <label for="response_5" class="cursor-pointer text-2xl hover:text-green-500">üòç</label>
                                    </div>
                                    <span class="text-xs text-gray-500">5</span>
                                </div>
                            </div>

                            <!-- Solution Quality Score -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    Kualitas Solusi
                                </label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-xs text-gray-500">1</span>
                                    <div class="flex space-x-2">
                                        <input type="radio" name="solution_quality_score" value="1" id="solution_1" class="hidden">
                                        <label for="solution_1" class="cursor-pointer text-2xl hover:text-red-500">üòû</label>
                                        <input type="radio" name="solution_quality_score" value="2" id="solution_2" class="hidden">
                                        <label for="solution_2" class="cursor-pointer text-2xl hover:text-orange-500">üòê</label>
                                        <input type="radio" name="solution_quality_score" value="3" id="solution_3" class="hidden">
                                        <label for="solution_3" class="cursor-pointer text-2xl hover:text-yellow-500">üòä</label>
                                        <input type="radio" name="solution_quality_score" value="4" id="solution_4" class="hidden">
                                        <label for="solution_4" class="cursor-pointer text-2xl hover:text-lime-500">üòÑ</label>
                                        <input type="radio" name="solution_quality_score" value="5" id="solution_5" class="hidden">
                                        <label for="solution_5" class="cursor-pointer text-2xl hover:text-green-500">üòç</label>
                                    </div>
                                    <span class="text-xs text-gray-500">5</span>
                                </div>
                            </div>

                            <!-- Staff Courtesy Score -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    Keramahan Petugas
                                </label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-xs text-gray-500">1</span>
                                    <div class="flex space-x-2">
                                        <input type="radio" name="staff_courtesy_score" value="1" id="staff_1" class="hidden">
                                        <label for="staff_1" class="cursor-pointer text-2xl hover:text-red-500">üòû</label>
                                        <input type="radio" name="staff_courtesy_score" value="2" id="staff_2" class="hidden">
                                        <label for="staff_2" class="cursor-pointer text-2xl hover:text-orange-500">üòê</label>
                                        <input type="radio" name="staff_courtesy_score" value="3" id="staff_3" class="hidden">
                                        <label for="staff_3" class="cursor-pointer text-2xl hover:text-yellow-500">üòä</label>
                                        <input type="radio" name="staff_courtesy_score" value="4" id="staff_4" class="hidden">
                                        <label for="staff_4" class="cursor-pointer text-2xl hover:text-lime-500">üòÑ</label>
                                        <input type="radio" name="staff_courtesy_score" value="5" id="staff_5" class="hidden">
                                        <label for="staff_5" class="cursor-pointer text-2xl hover:text-green-500">üòç</label>
                                    </div>
                                    <span class="text-xs text-gray-500">5</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comments -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Komentar dan Saran (Opsional)
                        </label>
                        <textarea id="comments" name="comments" rows="4" 
                            placeholder="Berikan komentar atau saran untuk perbaikan layanan..."
                            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-medium">
                            Kirim Survei
                        </button>
                    </div>
                </form>

                <!-- Results -->
                <div id="results" class="mt-8 p-4 bg-gray-100 rounded-lg hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Test Results:</h3>
                    <pre id="resultsContent" class="text-sm text-gray-600 whitespace-pre-wrap"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            loadUnits();
            loadServiceCategories();
            
            // Handle anonymous checkbox
            document.getElementById('is_anonymous').addEventListener('change', function() {
                const reporterFields = document.getElementById('reporterFields');
                const inputs = reporterFields.querySelectorAll('input');
                
                if (this.checked) {
                    reporterFields.style.opacity = '0.5';
                    inputs.forEach(input => {
                        input.disabled = true;
                        input.value = '';
                    });
                } else {
                    reporterFields.style.opacity = '1';
                    inputs.forEach(input => input.disabled = false);
                }
            });

            // Handle form submission
            document.getElementById('surveyForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitSurvey();
            });
        });

        async function loadUnits() {
            try {
                const response = await fetch(`${API_BASE}/public/units`);
                const result = await response.json();
                
                const select = document.getElementById('unit_id');
                select.innerHTML = '<option value="">Pilih Unit/Bagian</option>';
                
                if (result.success && result.data) {
                    result.data.forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit.id;
                        option.textContent = unit.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading units:', error);
            }
        }

        async function loadServiceCategories() {
            try {
                const response = await fetch(`${API_BASE}/public/service-categories`);
                const result = await response.json();
                
                const select = document.getElementById('service_category_id');
                select.innerHTML = '<option value="">Pilih Kategori Layanan</option>';
                
                if (result.success && result.data) {
                    result.data.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading service categories:', error);
            }
        }

        async function testUnitsAPI() {
            try {
                const response = await fetch(`${API_BASE}/public/units`);
                const result = await response.json();
                showResults('Units API Test', result);
            } catch (error) {
                showResults('Units API Test Error', { error: error.message });
            }
        }

        async function testServiceCategoriesAPI() {
            try {
                const response = await fetch(`${API_BASE}/public/service-categories`);
                const result = await response.json();
                showResults('Service Categories API Test', result);
            } catch (error) {
                showResults('Service Categories API Test Error', { error: error.message });
            }
        }

        async function testSurveySubmission() {
            const testData = {
                unit_id: 'test-unit-id',
                service_category_id: 'test-category-id',
                service_description: 'Test service description',
                reporter_name: 'Test User',
                reporter_email: 'test@example.com',
                reporter_phone: '08123456789',
                is_anonymous: false,
                overall_score: 5,
                response_time_score: 4,
                solution_quality_score: 5,
                staff_courtesy_score: 4,
                comments: 'Test comments',
                qr_token: null
            };

            try {
                const response = await fetch(`${API_BASE}/public/surveys`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                const result = await response.json();
                showResults('Survey Submission Test', result);
            } catch (error) {
                showResults('Survey Submission Test Error', { error: error.message });
            }
        }

        async function submitSurvey() {
            const formData = new FormData(document.getElementById('surveyForm'));
            const data = {};
            
            // Convert FormData to object
            for (let [key, value] of formData.entries()) {
                if (key.includes('_score') && value) {
                    data[key] = parseInt(value);
                } else if (key === 'is_anonymous') {
                    data[key] = true;
                } else {
                    data[key] = value;
                }
            }

            // Handle checkbox for anonymous
            data.is_anonymous = document.getElementById('is_anonymous').checked;

            // Validation
            if (!data.unit_id || !data.service_category_id || !data.service_description) {
                alert('Mohon lengkapi informasi layanan yang wajib diisi');
                return;
            }

            const hasRating = data.overall_score || data.response_time_score || 
                             data.solution_quality_score || data.staff_courtesy_score;
            if (!hasRating) {
                alert('Mohon berikan minimal satu penilaian');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/public/surveys`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Survei berhasil dikirim! Terima kasih atas feedback Anda.');
                    document.getElementById('surveyForm').reset();
                    showResults('Survey Submission Success', result);
                } else {
                    alert('Error: ' + result.error);
                    showResults('Survey Submission Error', result);
                }
            } catch (error) {
                alert('Terjadi kesalahan: ' + error.message);
                showResults('Survey Submission Error', { error: error.message });
            }
        }

        function showResults(title, data) {
            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('resultsContent');
            
            resultsContent.textContent = `${title}:\n\n${JSON.stringify(data, null, 2)}`;
            resultsDiv.classList.remove('hidden');
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>