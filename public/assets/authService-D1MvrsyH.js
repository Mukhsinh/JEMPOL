import{s}from"./index-CggBUVpX.js";import"./react-vendor-DNc2NRLZ.js";import"./router-CMiEwkfl.js";import"./supabase-client-0LnPeXwf.js";import"./http-client-B9ygI19o.js";import"./ui-components-B8NipDi_.js";class h{userKey="adminUser";async login(e,c){try{console.log("üîÑ AuthService: Attempting login..."),await s.auth.signOut(),await new Promise(r=>setTimeout(r,500));const t=e.trim().toLowerCase();if(!t||!c)return{success:!1,error:"Email dan password harus diisi"};console.log("üìß Login attempt for:",t);const i=s.auth.signInWithPassword({email:t,password:c}),g=new Promise((r,u)=>{setTimeout(()=>u(new Error("Login timeout")),15e3)}),{data:n,error:a}=await Promise.race([i,g]);if(a){console.error("‚ùå Auth error:",a);let r="Login gagal";return a.message?.includes("Invalid login credentials")?r="Email atau password salah":a.message?.includes("Email not confirmed")?r="Email belum dikonfirmasi":a.message?.includes("timeout")&&(r="Koneksi timeout, coba lagi"),{success:!1,error:r}}if(!n?.user||!n?.session)return{success:!1,error:"Login gagal - tidak ada data user"};console.log("‚úÖ Auth successful, fetching admin profile...");const d=s.from("admins").select("*").eq("email",t).eq("is_active",!0).single(),f=new Promise((r,u)=>{setTimeout(()=>u(new Error("Profile fetch timeout")),1e4)}),{data:o,error:m}=await Promise.race([d,f]);if(m||!o)return console.error("‚ùå Profile error:",m),await s.auth.signOut(),{success:!1,error:"Admin tidak ditemukan atau tidak aktif"};const l={id:o.id,username:o.username,full_name:o.full_name,email:o.email,role:o.role||"admin"};return localStorage.setItem(this.userKey,JSON.stringify(l)),console.log("‚úÖ Login successful:",l.email,"Role:",l.role),{success:!0,data:{session:n.session,user:n.user,admin:l},message:"Login berhasil"}}catch(t){console.error("‚ùå Unexpected login error:",t);let i="Terjadi kesalahan yang tidak terduga";return t.message?.includes("timeout")&&(i="Koneksi timeout, silakan coba lagi"),{success:!1,error:i}}}async logout(){try{await s.auth.signOut(),localStorage.removeItem(this.userKey),console.log("‚úÖ Logout successful")}catch(e){console.error("‚ùå Logout error:",e),localStorage.removeItem(this.userKey)}}async getToken(){try{const{data:{session:e}}=await s.auth.getSession();return e?.access_token||null}catch(e){return console.error("Error getting token:",e),null}}getUser(){const e=localStorage.getItem(this.userKey);return e?JSON.parse(e):null}async isAuthenticated(){try{const{data:{user:e}}=await s.auth.getUser();return!!e}catch{return!1}}isAdmin(){const e=this.getUser();return e&&(e.role==="admin"||e.role==="superadmin")}isSuperAdmin(){const e=this.getUser();return e&&e.role==="superadmin"}getSupabaseClient(){return s}}const A=new h;export{A as authService,A as default};
