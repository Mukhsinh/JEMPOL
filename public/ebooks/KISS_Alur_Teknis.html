<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Book Alur Teknis Aplikasi KISS</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
            @bottom-center {
                content: "aplikasiKISS@2024.Mukhsin Hadi. Hak Cipta dilindungi oleh Undang-Undang";
                font-size: 10px;
                color: #666;
            }
        }
        
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .cover {
            text-align: center;
            page-break-after: always;
            padding: 100px 0;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            margin: -20px;
            padding: 150px 20px;
        }
        
        .cover h1 {
            font-size: 48px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .cover h2 {
            font-size: 32px;
            margin-bottom: 40px;
            font-weight: normal;
        }
        
        .cover .subtitle {
            font-size: 24px;
            margin-bottom: 60px;
            font-style: italic;
        }
        
        .cover .author {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .cover .copyright {
            font-size: 14px;
            margin-top: 40px;
        }
        
        .cover .contact {
            font-size: 16px;
            margin-top: 30px;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        h1 {
            color: #2ecc71;
            border-bottom: 3px solid #2ecc71;
            padding-bottom: 10px;
            page-break-before: always;
        }
        
        h2 {
            color: #27ae60;
            margin-top: 30px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        
        .toc {
            page-break-after: always;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            margin: 10px 0;
            padding: 5px 0;
            border-bottom: 1px dotted #ccc;
        }
        
        .toc a {
            text-decoration: none;
            color: #2ecc71;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        code {
            background: #f8f9fa;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        .diagram {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .note {
            background: #e8f5e8;
            border-left: 5px solid #2ecc71;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #2ecc71;
            color: white;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            border-top: 2px solid #2ecc71;
            color: #666;
        }
        
        @media print {
            .cover {
                margin: 0;
            }
            
            body {
                font-size: 12px;
            }
            
            h1 {
                font-size: 18px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            h3 {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Cover Page -->
    <div class="cover">
        <h1>ğŸ“– E-BOOK ALUR TEKNIS</h1>
        <h2>APLIKASI KISS</h2>
        <div class="subtitle">(Kanal Informasi Saran dan Survei)</div>
        <div class="subtitle">Technical Architecture & Database Design</div>
        
        <div class="author">
            Penulis dan Pengembang:<br>
            MUKHSIN HADI, SE, M.Si, CGAA, CPFRM, CSEP, CRP, CPRM, CSCAP, CPABC
        </div>
        
        <div class="copyright">
            aplikasiKISS@2024.Mukhsin Hadi<br>
            Hak Cipta dilindungi oleh Undang-Undang
        </div>
        
        <div class="contact">
            <strong>Kontak dan Dukungan:</strong><br>
            ğŸ“§ support@kiss-app.com<br>
            ğŸŒ www.kiss-app.com<br>
            ğŸ“± http://wa.me/085726112001
        </div>
    </div>
            margin-bottom: 60px;
            opacity: 0.9;
        }
        
        .cover .author {
            font-size: 18px;
            margin-top: 80px;
            font-weight: bold;
        }
        
        .cover .footer {
            font-size: 12px;
            margin-top: 40px;
            opacity: 0.8;
        }
        
        h1 {
            color: #27ae60;
            border-bottom: 3px solid #2ecc71;
            padding-bottom: 10px;
            page-break-before: always;
        }
        
        h2 {
            color: #2c3e50;
            margin-top: 30px;
            border-left: 4px solid #2ecc71;
            padding-left: 15px;
        }
        
        h3 {
            color: #27ae60;
            margin-top: 25px;
        }
        
        .toc {
            page-break-after: always;
        }
        
        .toc ul {
            list-style: none;
            padding: 0;
        }
        
        .toc li {
            margin: 10px 0;
            padding: 5px 0;
            border-bottom: 1px dotted #ccc;
        }
        
        .tech-box {
            background: #e8f5e8;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .database-schema {
            background: #f0f8ff;
            border: 1px solid #87ceeb;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: #27ae60;
            color: white;
        }
        
        .page-break {
            page-break-before: always;
        }
        
        .no-break {
            page-break-inside: avoid;
        }
        
        .code-block {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            overflow-x: auto;
        }
        
        .architecture-diagram {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #27ae60;
            background: #f9f9f9;
        }
        
        .relationship-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>  
  <!-- Cover Page -->
    <div class="cover">
        <h1>E-BOOK</h1>
        <h2>ALUR TEKNIS APLIKASI KISS</h2>
        <div class="subtitle">Tabel dan Relasi Database</div>
        <div class="subtitle">Dokumentasi Teknis Lengkap</div>
        
        <div class="author">
            Penulis dan Pengembang:<br>
            <strong>MUKHSIN HADI, SE, M.Si, CGAA, CPFRM, CSEP, CRP, CPRM, CSCAP, CPABC</strong>
        </div>
        
        <div class="footer">
            aplikasiKISS@2024.Mukhsin Hadi<br>
            Hak Cipta dilindungi oleh Undang-Undang
        </div>
    </div>

    <!-- Table of Contents -->
    <div class="toc">
        <h1>DAFTAR ISI</h1>
        <ul>
            <li>BAB I: ARSITEKTUR SISTEM ................................................ 3</li>
            <li>BAB II: STRUKTUR DATABASE ............................................... 15</li>
            <li>BAB III: TABEL-TABEL UTAMA .............................................. 25</li>
            <li>BAB IV: RELASI ANTAR TABEL .............................................. 45</li>
            <li>BAB V: API ENDPOINTS DAN SERVICES ....................................... 65</li>
            <li>BAB VI: ALUR DATA DAN PROSES BISNIS ..................................... 85</li>
            <li>BAB VII: KEAMANAN DAN PERFORMANCE ....................................... 105</li>
            <li>BAB VIII: MONITORING DAN LOGGING ........................................ 125</li>
            <li>BAB IX: BACKUP DAN RECOVERY ............................................. 145</li>
            <li>BAB X: DEPLOYMENT DAN SCALING ........................................... 165</li>
            <li>LAMPIRAN TEKNIS ......................................................... 185</li>
        </ul>
    </div>

    <!-- Chapter 1: System Architecture -->
    <h1>BAB I: ARSITEKTUR SISTEM</h1>
    
    <h2>1.1 Overview Arsitektur</h2>
    <p>
        Aplikasi KISS dibangun menggunakan arsitektur modern yang mengutamakan skalabilitas, maintainability, 
        dan performance. Sistem ini mengadopsi pola arsitektur microservices dengan separation of concerns 
        yang jelas antara frontend, backend, dan database layer.
    </p>

    <div class="architecture-diagram">
        <h3>Arsitektur High-Level KISS</h3>
        <div style="text-align: left; font-family: monospace; font-size: 12px;">
            <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION LAYER                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React Frontend    â”‚  Mobile App    â”‚  QR Code Interface   â”‚
â”‚  (Port 3000)       â”‚  (React Native)â”‚  (Public Access)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Authentication & Authorization                           â”‚
â”‚  â€¢ Rate Limiting & Throttling                              â”‚
â”‚  â€¢ Request Routing & Load Balancing                        â”‚
â”‚  â€¢ API Versioning & Documentation                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BUSINESS LOGIC LAYER                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Auth Service  â”‚ Complaint Svc â”‚ AI Service â”‚ Notification â”‚
â”‚  User Mgmt     â”‚ Survey Svc    â”‚ Analytics  â”‚ Reporting    â”‚
â”‚  Master Data   â”‚ QR Code Svc   â”‚ Escalation â”‚ Integration  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL     â”‚  File Storage  â”‚  Cache Layer â”‚ Audit Log â”‚
â”‚  (Supabase)     â”‚  (Local/Cloud) â”‚  (Redis)     â”‚ (ELK)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
        </div>
    </div>

    <h2>1.2 Technology Stack</h2>
    
    <h3>1.2.1 Frontend Technologies</h3>
    <div class="tech-box">
        <strong>Core Framework:</strong> React 18.2.0 + TypeScript 4.9.5<br>
        <strong>Build Tool:</strong> Vite 4.4.5 (Fast HMR, ES modules)<br>
        <strong>Styling:</strong> Tailwind CSS 3.3.0 (Utility-first CSS)<br>
        <strong>State Management:</strong> React Context + useReducer<br>
        <strong>HTTP Client:</strong> Axios 1.4.0 (Promise-based HTTP client)<br>
        <strong>Routing:</strong> React Router 6.14.0 (Client-side routing)<br>
        <strong>Icons:</strong> Lucide React 0.263.1 (Modern icon library)<br>
        <strong>Real-time:</strong> Socket.io Client 4.7.2<br>
        <strong>Testing:</strong> Vitest + React Testing Library
    </div>

    <h3>1.2.2 Backend Technologies</h3>
    <div class="tech-box">
        <strong>Runtime:</strong> Node.js 18.17.0 LTS<br>
        <strong>Framework:</strong> Express.js 4.18.2<br>
        <strong>Language:</strong> TypeScript 5.1.6<br>
        <strong>Database:</strong> PostgreSQL 15.3 (via Supabase)<br>
        <strong>Authentication:</strong> JWT + bcryptjs<br>
        <strong>File Upload:</strong> Multer 1.4.5<br>
        <strong>Real-time:</strong> Socket.io 4.7.2<br>
        <strong>Validation:</strong> Joi 17.9.2<br>
        <strong>Logging:</strong> Winston 3.10.0<br>
        <strong>Testing:</strong> Jest + Supertest
    </div>

    <h3>1.2.3 Database & Infrastructure</h3>
    <div class="tech-box">
        <strong>Primary Database:</strong> PostgreSQL 15.3<br>
        <strong>Database Service:</strong> Supabase (BaaS)<br>
        <strong>Authentication:</strong> Supabase Auth<br>
        <strong>Real-time:</strong> Supabase Realtime<br>
        <strong>File Storage:</strong> Local Storage + Cloud Backup<br>
        <strong>Caching:</strong> Redis (planned)<br>
        <strong>Monitoring:</strong> Supabase Dashboard<br>
        <strong>Deployment:</strong> Vercel (Frontend) + Railway (Backend)
    </div>

    <h2>1.3 Design Patterns dan Principles</h2>
    
    <h3>1.3.1 Architectural Patterns</h3>
    <ul>
        <li><strong>MVC (Model-View-Controller):</strong> Separation of concerns dalam backend</li>
        <li><strong>Repository Pattern:</strong> Abstraksi layer database untuk maintainability</li>
        <li><strong>Service Layer Pattern:</strong> Business logic terpisah dari controller</li>
        <li><strong>Observer Pattern:</strong> Event-driven architecture untuk real-time updates</li>
        <li><strong>Factory Pattern:</strong> Dynamic service instantiation</li>
    </ul>

    <h3>1.3.2 SOLID Principles Implementation</h3>
    <div class="tech-box">
        <strong>Single Responsibility:</strong> Setiap class/module memiliki satu tanggung jawab<br>
        <strong>Open/Closed:</strong> Terbuka untuk extension, tertutup untuk modification<br>
        <strong>Liskov Substitution:</strong> Derived classes dapat menggantikan base classes<br>
        <strong>Interface Segregation:</strong> Interface yang spesifik dan focused<br>
        <strong>Dependency Inversion:</strong> Depend on abstractions, not concretions
    </div>

    <!-- Chapter 2: Database Structure -->
    <h1>BAB II: STRUKTUR DATABASE</h1>
    
    <h2>2.1 Database Schema Overview</h2>
    <p>
        Database KISS menggunakan PostgreSQL sebagai primary database dengan struktur yang dinormalisasi 
        untuk memastikan integritas data dan performa optimal. Schema dirancang untuk mendukung 
        skalabilitas horizontal dan vertical seiring pertumbuhan data.
    </p>

    <div class="database-schema">
        <h3>Database Configuration</h3>
        <div class="code-block">
-- Database: kiss_production
-- Version: PostgreSQL 15.3
-- Character Set: UTF8
-- Collation: en_US.UTF-8
-- Connection Limit: 100
-- Shared Buffers: 256MB
-- Effective Cache Size: 1GB
-- Work Memory: 4MB
-- Maintenance Work Memory: 64MB
        </div>
    </div>

    <h2>2.2 Schema Organization</h2>
    
    <h3>2.2.1 Schema Structure</h3>
    <table>
        <thead>
            <tr>
                <th>Schema</th>
                <th>Purpose</th>
                <th>Tables</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>public</td>
                <td>Main application data</td>
                <td>25+</td>
                <td>Core business entities dan operational data</td>
            </tr>
            <tr>
                <td>auth</td>
                <td>Authentication (Supabase)</td>
                <td>8</td>
                <td>User authentication dan session management</td>
            </tr>
            <tr>
                <td>audit</td>
                <td>Audit trail</td>
                <td>3</td>
                <td>Logging semua perubahan data untuk compliance</td>
            </tr>
            <tr>
                <td>analytics</td>
                <td>Data warehouse</td>
                <td>5</td>
                <td>Aggregated data untuk reporting dan analytics</td>
            </tr>
        </tbody>
    </table>

    <h2>2.3 Data Types dan Conventions</h2>
    
    <h3>2.3.1 Standard Data Types</h3>
    <div class="code-block">
-- Primary Keys: UUID (gen_random_uuid())
-- Timestamps: TIMESTAMPTZ (timezone aware)
-- Text Fields: VARCHAR(n) untuk bounded, TEXT untuk unbounded
-- JSON Data: JSONB (binary JSON untuk performance)
-- Enums: VARCHAR dengan CHECK constraints
-- Boolean: BOOLEAN dengan DEFAULT values
-- Numeric: DECIMAL untuk currency, INTEGER untuk counts
    </div>

    <h3>2.3.2 Naming Conventions</h3>
    <ul>
        <li><strong>Tables:</strong> snake_case, plural nouns (e.g., service_categories)</li>
        <li><strong>Columns:</strong> snake_case, descriptive names (e.g., created_at)</li>
        <li><strong>Indexes:</strong> idx_tablename_columnname (e.g., idx_tickets_status)</li>
        <li><strong>Foreign Keys:</strong> fk_tablename_referenced_table (e.g., fk_tickets_units)</li>
        <li><strong>Constraints:</strong> chk_tablename_condition (e.g., chk_tickets_priority)</li>
    </ul>

    <!-- Chapter 3: Main Tables -->
    <h1>BAB III: TABEL-TABEL UTAMA</h1>
    
    <h2>3.1 Core Entity Tables</h2>
    
    <h3>3.1.1 Tabel ADMINS</h3>
    <div class="database-schema">
        <h4>Purpose: Authentication dan user management untuk admin</h4>
        <div class="code-block">
CREATE TABLE admins (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(255) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    full_name VARCHAR(255),
    email VARCHAR(255) UNIQUE,
    role VARCHAR(50) DEFAULT 'admin' 
        CHECK (role IN ('admin', 'superadmin')),
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- Indexes
CREATE INDEX idx_admins_username ON admins(username);
CREATE INDEX idx_admins_email ON admins(email);
CREATE INDEX idx_admins_role ON admins(role);
CREATE INDEX idx_admins_is_active ON admins(is_active);

-- Comments
COMMENT ON TABLE admins IS 'Tabel untuk menyimpan data admin dan authentication';
COMMENT ON COLUMN admins.username IS 'Username untuk login (unique)';
COMMENT ON COLUMN admins.password_hash IS 'Password yang sudah di-hash dengan bcrypt';
COMMENT ON COLUMN admins.role IS 'Role admin: admin atau superadmin';
COMMENT ON COLUMN admins.is_active IS 'Status aktif admin';
        </div>
    </div>

    <h3>3.1.2 Tabel UNITS</h3>
    <div class="database-schema">
        <h4>Purpose: Organizational units/departments untuk routing tiket</h4>
        <div class="code-block">
CREATE TABLE units (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    parent_unit_id UUID REFERENCES units(id),
    unit_type_id UUID REFERENCES unit_types(id),
    description TEXT,
    contact_email VARCHAR(255),
    contact_phone VARCHAR(50),
    sla_hours INTEGER DEFAULT 24,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- Indexes
CREATE INDEX idx_units_code ON units(code);
CREATE INDEX idx_units_parent_unit_id ON units(parent_unit_id);
CREATE INDEX idx_units_unit_type_id ON units(unit_type_id);
CREATE INDEX idx_units_is_active ON units(is_active);

-- Self-referencing foreign key
ALTER TABLE units ADD CONSTRAINT fk_units_parent_unit 
    FOREIGN KEY (parent_unit_id) REFERENCES units(id);
        </div>
    </div>

    <h3>3.1.3 Tabel TICKETS</h3>
    <div class="database-schema">
        <h4>Purpose: Core table untuk semua jenis tiket (keluhan, saran, informasi)</h4>
        <div class="code-block">
CREATE TABLE tickets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ticket_number VARCHAR(50) UNIQUE NOT NULL,
    type VARCHAR(50) NOT NULL CHECK (type IN (
        'information', 'complaint', 'suggestion', 'satisfaction'
    )),
    category_id UUID REFERENCES service_categories(id),
    title VARCHAR(500) NOT NULL,
    description TEXT NOT NULL,
    
    -- Submitter information
    submitter_name VARCHAR(255),
    submitter_email VARCHAR(255),
    submitter_phone VARCHAR(50),
    submitter_address TEXT,
    is_anonymous BOOLEAN DEFAULT false,
    
    -- Assignment and routing
    unit_id UUID NOT NULL REFERENCES units(id),
    assigned_to UUID REFERENCES users(id),
    created_by UUID REFERENCES users(id),
    
    -- Status and priority
    status VARCHAR(50) DEFAULT 'open' CHECK (status IN (
        'open', 'in_progress', 'escalated', 'resolved', 'closed'
    )),
    priority VARCHAR(50) DEFAULT 'medium' CHECK (priority IN (
        'low', 'medium', 'high', 'critical'
    )),
    urgency_level INTEGER DEFAULT 3 CHECK (urgency_level BETWEEN 1 AND 5),
    
    -- AI Analysis
    ai_classification JSONB,
    sentiment_score DECIMAL(3,2),
    confidence_score DECIMAL(3,2),
    
    -- SLA Management
    sla_deadline TIMESTAMPTZ,
    first_response_at TIMESTAMPTZ,
    resolved_at TIMESTAMPTZ,
    
    -- Tracking
    source VARCHAR(50) DEFAULT 'web' CHECK (source IN (
        'web', 'qr_code', 'mobile', 'email', 'phone'
    )),
    qr_code_id UUID REFERENCES qr_codes(id),
    ip_address INET,
    user_agent TEXT,
    
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- Performance Indexes
CREATE INDEX idx_tickets_ticket_number ON tickets(ticket_number);
CREATE INDEX idx_tickets_type ON tickets(type);
CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_tickets_priority ON tickets(priority);
CREATE INDEX idx_tickets_unit_id ON tickets(unit_id);
CREATE INDEX idx_tickets_assigned_to ON tickets(assigned_to);
CREATE INDEX idx_tickets_created_at ON tickets(created_at);
CREATE INDEX idx_tickets_sla_deadline ON tickets(sla_deadline);
CREATE INDEX idx_tickets_source ON tickets(source);

-- Composite Indexes untuk query optimization
CREATE INDEX idx_tickets_status_priority ON tickets(status, priority);
CREATE INDEX idx_tickets_unit_status ON tickets(unit_id, status);
CREATE INDEX idx_tickets_assigned_status ON tickets(assigned_to, status);
        </div>
    </div>

    <h2>3.2 Supporting Tables</h2>
    
    <h3>3.2.1 Tabel SERVICE_CATEGORIES</h3>
    <div class="database-schema">
        <div class="code-block">
CREATE TABLE service_categories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    default_sla_hours INTEGER DEFAULT 24,
    requires_attachment BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- Sample Data
INSERT INTO service_categories (name, code, description, default_sla_hours) VALUES
('Pelayanan Medis', 'MED', 'Keluhan terkait pelayanan medis dan klinis', 24),
('Administrasi', 'ADM', 'Keluhan terkait proses administrasi', 48),
('Fasilitas', 'FAC', 'Keluhan terkait fasilitas dan infrastruktur', 72),
('SDM', 'HRM', 'Keluhan terkait sumber daya manusia', 48),
('Keuangan', 'FIN', 'Keluhan terkait pembayaran dan keuangan', 24),
('Farmasi', 'PHR', 'Keluhan terkait pelayanan farmasi', 24),
('Laboratorium', 'LAB', 'Keluhan terkait pelayanan laboratorium', 24);
        </div>
    </div>

    <h3>3.2.2 Tabel QR_CODES</h3>
    <div class="database-schema">
        <div class="code-block">
CREATE TABLE qr_codes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    unit_id UUID NOT NULL REFERENCES units(id),
    code VARCHAR(255) UNIQUE NOT NULL,
    token VARCHAR(500) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- Indexes
CREATE INDEX idx_qr_codes_unit_id ON qr_codes(unit_id);
CREATE INDEX idx_qr_codes_code ON qr_codes(code);
CREATE INDEX idx_qr_codes_token ON qr_codes(token);
CREATE INDEX idx_qr_codes_is_active ON qr_codes(is_active);

-- Function untuk generate QR code
CREATE OR REPLACE FUNCTION generate_qr_code(unit_name VARCHAR)
RETURNS VARCHAR AS $$
BEGIN
    RETURN 'QR-' || UPPER(LEFT(unit_name, 3)) || '-' || 
           TO_CHAR(NOW(), 'YYYYMMDD') || '-' || 
           LPAD(FLOOR(RANDOM() * 10000)::TEXT, 4, '0');
END;
$$ LANGUAGE plpgsql;
        </div>
    </div>

    <!-- Chapter 4: Table Relationships -->
    <h1>BAB IV: RELASI ANTAR TABEL</h1>
    
    <h2>4.1 Entity Relationship Diagram</h2>
    
    <div class="architecture-diagram">
        <h3>ERD - Core Entities</h3>
        <div style="text-align: left; font-family: monospace; font-size: 10px;">
            <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ADMINS      â”‚    â”‚     USERS       â”‚    â”‚     UNITS       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚    â”‚ id (PK)         â”‚    â”‚ id (PK)         â”‚
â”‚ username        â”‚    â”‚ admin_id (FK)   â”‚â”€â”€â”€â”€â”‚ name            â”‚
â”‚ password_hash   â”‚    â”‚ full_name       â”‚    â”‚ code            â”‚
â”‚ email           â”‚    â”‚ email           â”‚    â”‚ parent_unit_id  â”‚â”€â”€â”
â”‚ role            â”‚    â”‚ unit_id (FK)    â”‚â”€â”€â”€â”€â”‚ unit_type_id    â”‚  â”‚
â”‚ is_active       â”‚    â”‚ role            â”‚    â”‚ sla_hours       â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ is_active       â”‚    â”‚ is_active       â”‚  â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                       â”‚                       â”‚         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚         â”‚
                                                         â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚         â”‚
â”‚  UNIT_TYPES     â”‚    â”‚   QR_CODES      â”‚              â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚         â”‚
â”‚ id (PK)         â”‚â”€â”€â”€â”€â”‚ id (PK)         â”‚              â”‚         â”‚
â”‚ name            â”‚    â”‚ unit_id (FK)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚ code            â”‚    â”‚ code            â”‚                        â”‚
â”‚ icon            â”‚    â”‚ token           â”‚                        â”‚
â”‚ color           â”‚    â”‚ usage_count     â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                â”‚                                  â”‚
                                â”‚                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚SERVICE_CATEGORIESâ”‚   â”‚    TICKETS      â”‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚ id (PK)         â”‚â”€â”€â”€â”€â”‚ id (PK)         â”‚                        â”‚
â”‚ name            â”‚    â”‚ ticket_number   â”‚                        â”‚
â”‚ code            â”‚    â”‚ category_id(FK) â”‚                        â”‚
â”‚ default_sla_hrs â”‚    â”‚ unit_id (FK)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ assigned_to(FK) â”‚
                       â”‚ qr_code_id (FK) â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ type            â”‚
                       â”‚ status          â”‚
                       â”‚ priority        â”‚
                       â”‚ ai_classificationâ”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TICKET_RESPONSES â”‚    â”‚TICKET_ESCALATIONSâ”‚   â”‚SATISFACTION_SRVSâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚    â”‚ id (PK)         â”‚    â”‚ id (PK)         â”‚
â”‚ ticket_id (FK)  â”‚â”€â”€â”€â”€â”‚ ticket_id (FK)  â”‚â”€â”€â”€â”€â”‚ ticket_id (FK)  â”‚
â”‚ responder_id(FK)â”‚    â”‚ from_user_id(FK)â”‚    â”‚ overall_score   â”‚
â”‚ message         â”‚    â”‚ to_user_id (FK) â”‚    â”‚ response_time   â”‚
â”‚ is_internal     â”‚    â”‚ reason          â”‚    â”‚ solution_qualityâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ staff_courtesy  â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
        </div>
    </div>

    <h2>4.2 Foreign Key Relationships</h2>
    
    <h3>4.2.1 Primary Relationships</h3>
    <table>
        <thead>
            <tr>
                <th>Child Table</th>
                <th>Foreign Key</th>
                <th>Parent Table</th>
                <th>Relationship Type</th>
                <th>Cascade Rule</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>users</td>
                <td>admin_id</td>
                <td>admins</td>
                <td>One-to-One</td>
                <td>SET NULL</td>
            </tr>
            <tr>
                <td>users</td>
                <td>unit_id</td>
                <td>units</td>
                <td>Many-to-One</td>
                <td>RESTRICT</td>
            </tr>
            <tr>
                <td>units</td>
                <td>parent_unit_id</td>
                <td>units</td>
                <td>Self-Reference</td>
                <td>SET NULL</td>
            </tr>
            <tr>
                <td>units</td>
                <td>unit_type_id</td>
                <td>unit_types</td>
                <td>Many-to-One</td>
                <td>RESTRICT</td>
            </tr>
            <tr>
                <td>tickets</td>
                <td>unit_id</td>
                <td>units</td>
                <td>Many-to-One</td>
                <td>RESTRICT</td>
            </tr>
            <tr>
                <td>tickets</td>
                <td>category_id</td>
                <td>service_categories</td>
                <td>Many-to-One</td>
                <td>SET NULL</td>
            </tr>
            <tr>
                <td>tickets</td>
                <td>assigned_to</td>
                <td>users</td>
                <td>Many-to-One</td>
                <td>SET NULL</td>
            </tr>
            <tr>
                <td>qr_codes</td>
                <td>unit_id</td>
                <td>units</td>
                <td>Many-to-One</td>
                <td>CASCADE</td>
            </tr>
        </tbody>
    </table>

    <h3>4.2.2 Referential Integrity Constraints</h3>
    <div class="code-block">
-- Constraint untuk memastikan data integrity
ALTER TABLE tickets ADD CONSTRAINT chk_tickets_priority 
    CHECK (priority IN ('low', 'medium', 'high', 'critical'));

ALTER TABLE tickets ADD CONSTRAINT chk_tickets_status 
    CHECK (status IN ('open', 'in_progress', 'escalated', 'resolved', 'closed'));

ALTER TABLE tickets ADD CONSTRAINT chk_tickets_urgency 
    CHECK (urgency_level BETWEEN 1 AND 5);

-- Constraint untuk SLA deadline
ALTER TABLE tickets ADD CONSTRAINT chk_tickets_sla_deadline 
    CHECK (sla_deadline > created_at);

-- Constraint untuk resolved_at
ALTER TABLE tickets ADD CONSTRAINT chk_tickets_resolved_at 
    CHECK (resolved_at IS NULL OR resolved_at >= created_at);

-- Unique constraint untuk ticket_number dengan format
ALTER TABLE tickets ADD CONSTRAINT chk_tickets_number_format 
    CHECK (ticket_number ~ '^TKT-[0-9]{8}-[0-9]{4}$');
    </div>

    <h2>4.3 Junction Tables</h2>
    
    <h3>4.3.1 Tabel USER_ROLES (Many-to-Many)</h3>
    <div class="database-schema">
        <div class="code-block">
CREATE TABLE user_roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
    assigned_at TIMESTAMPTZ DEFAULT now(),
    assigned_by UUID REFERENCES users(id),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now(),
    
    -- Prevent duplicate assignments
    UNIQUE(user_id, role_id)
);

-- Indexes untuk performance
CREATE INDEX idx_user_roles_user_id ON user_roles(user_id);
CREATE INDEX idx_user_roles_role_id ON user_roles(role_id);
CREATE INDEX idx_user_roles_is_active ON user_roles(is_active);
        </div>
    </div>

    <h3>4.3.2 Tabel TICKET_ATTACHMENTS</h3>
    <div class="database-schema">
        <div class="code-block">
CREATE TABLE ticket_attachments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ticket_id UUID NOT NULL REFERENCES tickets(id) ON DELETE CASCADE,
    file_name VARCHAR(255) NOT NULL,
    file_path TEXT NOT NULL,
    file_size BIGINT NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    uploaded_by UUID REFERENCES users(id),
    created_at TIMESTAMPTZ DEFAULT now(),
    
    -- Constraints
    CHECK (file_size > 0 AND file_size <= 104857600), -- Max 100MB
    CHECK (mime_type IN (
        'image/jpeg', 'image/png', 'image/gif',
        'application/pdf', 'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'video/mp4', 'video/avi', 'video/quicktime'
    ))
);

-- Indexes
CREATE INDEX idx_ticket_attachments_ticket_id ON ticket_attachments(ticket_id);
CREATE INDEX idx_ticket_attachments_mime_type ON ticket_attachments(mime_type);
        </div>
    </div>

    <!-- Continue with more technical chapters... -->
    
    <!-- Footer -->
    <div style="page-break-before: always; text-align: center; padding: 50px 0;">
        <h2>TENTANG PENULIS</h2>
        <div style="background: #f8f9fa; padding: 30px; border-radius: 10px; margin: 20px 0;">
            <h3>MUKHSIN HADI, SE, M.Si, CGAA, CPFRM, CSEP, CRP, CPRM, CSCAP, CPABC</h3>
            <p>
                Praktisi dan akademisi di bidang sistem informasi manajemen dengan pengalaman lebih dari 15 tahun 
                dalam pengembangan aplikasi enterprise untuk sektor publik. Memiliki sertifikasi internasional 
                dalam bidang audit, risk management, dan project management.
            </p>
            <p>
                Saat ini menjabat sebagai konsultan senior untuk berbagai proyek digitalisasi di sektor kesehatan 
                dan pemerintahan. Aktif dalam penelitian dan pengembangan sistem informasi berbasis AI untuk 
                meningkatkan kualitas pelayanan publik.
            </p>
        </div>
        
        <div style="margin-top: 50px; font-size: 12px; color: #666;">
            <p>aplikasiKISS@2024.Mukhsin Hadi</p>
            <p>Hak Cipta dilindungi oleh Undang-Undang</p>
            <p>Dilarang memperbanyak sebagian atau seluruh isi buku ini tanpa izin tertulis dari penulis</p>
        </div>
    </div>
</body>
</html>   
 <!-- Table of Contents -->
    <div class="toc">
        <h1>DAFTAR ISI</h1>
        <ul>
            <li><a href="#arsitektur-sistem">1. Arsitektur Sistem</a></li>
            <li><a href="#database-schema">2. Database Schema dan Relasi</a></li>
            <li><a href="#api-architecture">3. API Architecture</a></li>
            <li><a href="#alur-data">4. Alur Data dan Proses</a></li>
            <li><a href="#integrasi-sistem">5. Integrasi Sistem</a></li>
            <li><a href="#security">6. Security Implementation</a></li>
            <li><a href="#performance">7. Performance Optimization</a></li>
            <li><a href="#monitoring">8. Monitoring dan Logging</a></li>
            <li><a href="#deployment">9. Deployment Architecture</a></li>
        </ul>
    </div>

    <!-- Chapter 1: Arsitektur Sistem -->
    <h1 id="arsitektur-sistem">1. ARSITEKTUR SISTEM</h1>
    
    <h2>1.1 High-Level System Architecture</h2>
    
    <div class="diagram">
        <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PRESENTATION LAYER                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Web Client    â”‚   Mobile PWA    â”‚      Admin Panel            â”‚
â”‚   (React)       â”‚   (React)       â”‚      (React)                â”‚
â”‚                 â”‚                 â”‚                             â”‚
â”‚ - Public Forms  â”‚ - QR Scanner    â”‚ - Dashboard                 â”‚
â”‚ - Tracking      â”‚ - Offline Mode  â”‚ - User Management           â”‚
â”‚ - Surveys       â”‚ - Push Notif    â”‚ - Reports                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    API GATEWAY      â”‚
                    â”‚                     â”‚
                    â”‚ - Authentication    â”‚
                    â”‚ - Rate Limiting     â”‚
                    â”‚ - Load Balancing    â”‚
                    â”‚ - Request Routing   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APPLICATION LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Complaint      â”‚   User          â”‚    Notification             â”‚
â”‚  Service        â”‚   Service       â”‚    Service                  â”‚
â”‚                 â”‚                 â”‚                             â”‚
â”‚ - CRUD Ops      â”‚ - Auth          â”‚ - Multi-channel             â”‚
â”‚ - AI Process    â”‚ - Role Mgmt     â”‚ - Templates                 â”‚
â”‚ - Escalation    â”‚ - Permissions   â”‚ - Scheduling                â”‚
â”‚ - SLA Mgmt      â”‚ - Profile       â”‚ - Delivery                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   PostgreSQL    â”‚   File Storage  â”‚    Cache Layer              â”‚
â”‚   (Supabase)    â”‚   (Local/Cloud) â”‚    (Redis)                  â”‚
â”‚                 â”‚                 â”‚                             â”‚
â”‚ - Transactional â”‚ - Attachments   â”‚ - Session Data              â”‚
â”‚ - Real-time     â”‚ - Documents     â”‚ - Temp Data                 â”‚
â”‚ - Backup        â”‚ - Media Files   â”‚ - Query Cache               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </pre>
    </div>

    <h2>1.2 Technology Stack Detail</h2>
    
    <h3>1.2.1 Frontend Stack</h3>
    <ul>
        <li><strong>React 18</strong> + TypeScript - Modern UI framework dengan type safety</li>
        <li><strong>Vite</strong> - Build tool modern dan cepat</li>
        <li><strong>Tailwind CSS</strong> - Utility-first CSS framework</li>
        <li><strong>React Router</strong> - Client-side routing</li>
        <li><strong>Axios</strong> - HTTP client untuk API calls</li>
        <li><strong>Socket.io Client</strong> - Real-time communication</li>
        <li><strong>Lucide React</strong> - Icon library</li>
        <li><strong>Phaser</strong> - Game engine untuk Innovation Catcher</li>
    </ul>

    <h3>1.2.2 Backend Stack</h3>
    <ul>
        <li><strong>Node.js</strong> + Express.js - Server runtime dan framework</li>
        <li><strong>TypeScript</strong> - Type safety dan developer experience</li>
        <li><strong>Supabase</strong> - Database PostgreSQL dan Authentication</li>
        <li><strong>Socket.io</strong> - Real-time features</li>
        <li><strong>Multer</strong> - File upload handling</li>
        <li><strong>JWT</strong> - Token-based authentication</li>
        <li><strong>bcryptjs</strong> - Password hashing</li>
    </ul>

    <!-- Chapter 2: Database Schema -->
    <h1 id="database-schema">2. DATABASE SCHEMA DAN RELASI</h1>
    
    <h2>2.1 Tabel Utama dan Struktur</h2>
    
    <h3>2.1.1 Tabel ADMINS</h3>
    <pre><code>CREATE TABLE admins (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(255) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    full_name VARCHAR(255),
    email VARCHAR(255),
    role VARCHAR(50) CHECK (role IN ('admin', 'superadmin')) DEFAULT 'admin',
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);</code></pre>

    <h3>2.1.2 Tabel USERS</h3>
    <pre><code>CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    admin_id UUID REFERENCES admins(id),
    employee_id VARCHAR(50),
    full_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(50),
    unit_id UUID REFERENCES units(id),
    role VARCHAR(50) CHECK (role IN ('staff', 'supervisor', 'manager', 'director', 'admin')) NOT NULL,
    role_id UUID REFERENCES roles(id),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);</code></pre>

    <h3>2.1.3 Tabel TICKETS</h3>
    <pre><code>CREATE TABLE tickets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ticket_number VARCHAR(50) UNIQUE NOT NULL,
    type VARCHAR(50) CHECK (type IN ('information', 'complaint', 'suggestion', 'satisfaction')) NOT NULL,
    category_id UUID REFERENCES service_categories(id),
    title VARCHAR(500) NOT NULL,
    description TEXT NOT NULL,
    
    -- Submitter Information
    submitter_name VARCHAR(255),
    submitter_email VARCHAR(255),
    submitter_phone VARCHAR(50),
    submitter_address TEXT,
    is_anonymous BOOLEAN DEFAULT false,
    
    -- Assignment and Routing
    unit_id UUID REFERENCES units(id) NOT NULL,
    assigned_to UUID REFERENCES users(id),
    created_by UUID REFERENCES users(id),
    
    -- Status and Priority
    status VARCHAR(50) DEFAULT 'open',
    priority VARCHAR(50) DEFAULT 'medium',
    urgency_level INTEGER DEFAULT 3 CHECK (urgency_level BETWEEN 1 AND 5),
    
    -- AI Analysis
    ai_classification JSONB,
    sentiment_score DECIMAL(3,2),
    confidence_score DECIMAL(3,2),
    
    -- SLA Management
    sla_deadline TIMESTAMPTZ,
    first_response_at TIMESTAMPTZ,
    resolved_at TIMESTAMPTZ,
    
    -- Tracking
    source VARCHAR(50) DEFAULT 'web',
    qr_code_id UUID REFERENCES qr_codes(id),
    ip_address INET,
    user_agent TEXT,
    
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);</code></pre>

    <div class="note">
        <strong>Catatan:</strong> Struktur database dirancang untuk mendukung skalabilitas dan fleksibilitas dalam pengelolaan keluhan dengan berbagai jenis dan kategori.
    </div>

    <!-- Chapter 3: API Architecture -->
    <h1 id="api-architecture">3. API ARCHITECTURE</h1>
    
    <h2>3.1 RESTful API Design</h2>
    
    <h3>3.1.1 API Endpoints Structure</h3>
    <pre><code>/api/v1/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ POST /login
â”‚   â”œâ”€â”€ POST /logout
â”‚   â”œâ”€â”€ GET /verify
â”‚   â””â”€â”€ POST /refresh
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ POST /tickets
â”‚   â”œâ”€â”€ GET /tickets/:number
â”‚   â”œâ”€â”€ GET /qr/:token
â”‚   â””â”€â”€ POST /qr/:token/tickets
â”œâ”€â”€ tickets/
â”‚   â”œâ”€â”€ GET /
â”‚   â”œâ”€â”€ POST /
â”‚   â”œâ”€â”€ GET /:id
â”‚   â”œâ”€â”€ PUT /:id
â”‚   â”œâ”€â”€ DELETE /:id
â”‚   â”œâ”€â”€ POST /:id/responses
â”‚   â”œâ”€â”€ POST /:id/escalate
â”‚   â””â”€â”€ POST /:id/assign
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ GET /
â”‚   â”œâ”€â”€ POST /
â”‚   â”œâ”€â”€ GET /:id
â”‚   â”œâ”€â”€ PUT /:id
â”‚   â””â”€â”€ DELETE /:id
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ GET /metrics
â”‚   â”œâ”€â”€ GET /kpi
â”‚   â””â”€â”€ GET /analytics
â””â”€â”€ reports/
    â”œâ”€â”€ GET /tickets
    â”œâ”€â”€ GET /satisfaction
    â””â”€â”€ GET /performance</code></pre>

    <h2>3.2 Authentication & Authorization</h2>
    
    <h3>3.2.1 JWT Token Structure</h3>
    <pre><code>interface JWTPayload {
  sub: string;        // User ID
  email: string;      // User email
  role: string;       // Primary role
  roles: string[];    // All roles
  unit_id?: string;   // Unit ID
  permissions: string[]; // Permissions
  iat: number;        // Issued at
  exp: number;        // Expires at
  iss: string;        // Issuer
}</code></pre>

    <!-- Chapter 4: Alur Data dan Proses -->
    <h1 id="alur-data">4. ALUR DATA DAN PROSES</h1>
    
    <h2>4.1 Ticket Lifecycle</h2>
    
    <h3>4.1.1 Alur Pengajuan Keluhan</h3>
    <div class="diagram">
        <pre>
1. User Input (QR Code/Web) 
   â†“
2. Validation & Sanitization
   â†“
3. AI Processing (Classification, Sentiment)
   â†“
4. Auto Routing (Unit Assignment)
   â†“
5. Staff Assignment (Auto/Manual)
   â†“
6. Notification (Multi-channel)
   â†“
7. Processing & Response
   â†“
8. Escalation (if needed)
   â†“
9. Resolution
   â†“
10. Survey & Feedback
    â†“
11. Closure & Archival
        </pre>
    </div>

    <h3>4.1.2 Status Transitions</h3>
    <div class="diagram">
        <pre>
Open â†’ In Progress â†’ Resolved â†’ Closed
  â†“         â†“           â†“
Escalated â†’ On Hold â†’ Cancelled
        </pre>
    </div>

    <!-- Chapter 5: Integrasi Sistem -->
    <h1 id="integrasi-sistem">5. INTEGRASI SISTEM</h1>
    
    <h2>5.1 External Services Integration</h2>
    
    <h3>5.1.1 Email Service</h3>
    <pre><code>interface EmailService {
  sendEmail(params: EmailParams): Promise&lt;EmailResult&gt;;
  sendBulkEmail(params: BulkEmailParams): Promise&lt;BulkEmailResult&gt;;
  getDeliveryStatus(messageId: string): Promise&lt;DeliveryStatus&gt;;
}</code></pre>

    <h3>5.1.2 WhatsApp Integration</h3>
    <pre><code>interface WhatsAppService {
  sendMessage(params: WhatsAppMessageParams): Promise&lt;WhatsAppResult&gt;;
  sendTemplate(params: WhatsAppTemplateParams): Promise&lt;WhatsAppResult&gt;;
  getMessageStatus(messageId: string): Promise&lt;MessageStatus&gt;;
}</code></pre>

    <!-- Chapter 6: Security Implementation -->
    <h1 id="security">6. SECURITY IMPLEMENTATION</h1>
    
    <h2>6.1 Authentication Security</h2>
    
    <div class="warning">
        <strong>Peringatan Keamanan:</strong> Semua password harus menggunakan hashing bcrypt dengan salt rounds minimal 12 untuk keamanan optimal.
    </div>

    <h3>6.1.1 Password Security</h3>
    <pre><code>class PasswordService {
  private readonly saltRounds = 12;
  
  async hashPassword(password: string): Promise&lt;string&gt; {
    return await bcrypt.hash(password, this.saltRounds);
  }
  
  async verifyPassword(password: string, hash: string): Promise&lt;boolean&gt; {
    return await bcrypt.compare(password, hash);
  }
  
  validatePasswordStrength(password: string): ValidationResult {
    const minLength = 8;
    const hasUpperCase = /[A-Z]/.test(password);
    const hasLowerCase = /[a-z]/.test(password);
    const hasNumbers = /\d/.test(password);
    const hasSpecialChar = /[!@#$%^&*(),.?":{}|&lt;&gt;]/.test(password);
    
    const errors = [];
    if (password.length &lt; minLength) errors.push('Password must be at least 8 characters');
    if (!hasUpperCase) errors.push('Password must contain uppercase letter');
    if (!hasLowerCase) errors.push('Password must contain lowercase letter');
    if (!hasNumbers) errors.push('Password must contain number');
    if (!hasSpecialChar) errors.push('Password must contain special character');
    
    return {
      isValid: errors.length === 0,
      errors
    };
  }
}</code></pre>

    <!-- Chapter 7: Performance Optimization -->
    <h1 id="performance">7. PERFORMANCE OPTIMIZATION</h1>
    
    <h2>7.1 Database Optimization</h2>
    
    <h3>7.1.1 Indexing Strategy</h3>
    <pre><code>-- Performance indexes
CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_tickets_unit_id ON tickets(unit_id);
CREATE INDEX idx_tickets_assigned_to ON tickets(assigned_to);
CREATE INDEX idx_tickets_created_at ON tickets(created_at);
CREATE INDEX idx_tickets_sla_deadline ON tickets(sla_deadline);

-- Composite indexes
CREATE INDEX idx_tickets_status_unit ON tickets(status, unit_id);
CREATE INDEX idx_tickets_assigned_status ON tickets(assigned_to, status);</code></pre>

    <h2>7.2 Caching Strategy</h2>
    
    <h3>7.2.1 Redis Caching</h3>
    <pre><code>class CacheService {
  private redis: Redis;
  
  constructor() {
    this.redis = new Redis(process.env.REDIS_URL);
  }
  
  async get&lt;T&gt;(key: string): Promise&lt;T | null&gt; {
    const cached = await this.redis.get(key);
    return cached ? JSON.parse(cached) : null;
  }
  
  async set(key: string, value: any, ttl: number = 3600): Promise&lt;void&gt; {
    await this.redis.setex(key, ttl, JSON.stringify(value));
  }
  
  async invalidate(pattern: string): Promise&lt;void&gt; {
    const keys = await this.redis.keys(pattern);
    if (keys.length &gt; 0) {
      await this.redis.del(...keys);
    }
  }
}</code></pre>

    <!-- Chapter 8: Monitoring dan Logging -->
    <h1 id="monitoring">8. MONITORING DAN LOGGING</h1>
    
    <h2>8.1 Application Monitoring</h2>
    
    <h3>8.1.1 Metrics Collection</h3>
    <pre><code>class MetricsService {
  private metrics = {
    requests: new Map&lt;string, number&gt;(),
    responseTime: new Map&lt;string, number[]&gt;(),
    errors: new Map&lt;string, number&gt;(),
    activeUsers: new Set&lt;string&gt;()
  };
  
  recordRequest(endpoint: string, responseTime: number, statusCode: number) {
    // Count requests
    this.metrics.requests.set(
      endpoint, 
      (this.metrics.requests.get(endpoint) || 0) + 1
    );
    
    // Record response time
    if (!this.metrics.responseTime.has(endpoint)) {
      this.metrics.responseTime.set(endpoint, []);
    }
    this.metrics.responseTime.get(endpoint)!.push(responseTime);
    
    // Count errors
    if (statusCode &gt;= 400) {
      this.metrics.errors.set(
        endpoint,
        (this.metrics.errors.get(endpoint) || 0) + 1
      );
    }
  }
}</code></pre>

    <!-- Chapter 9: Deployment Architecture -->
    <h1 id="deployment">9. DEPLOYMENT ARCHITECTURE</h1>
    
    <h2>9.1 Production Deployment</h2>
    
    <h3>9.1.1 Infrastructure Setup</h3>
    <pre><code># docker-compose.yml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - VITE_API_URL=http://backend:5000/api
    depends_on:
      - backend
  
  backend:
    build: ./backend
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - postgres
      - redis
  
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=kiss_db
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:</code></pre>

    <div class="note">
        <strong>Catatan Deployment:</strong> Pastikan semua environment variables telah dikonfigurasi dengan benar sebelum melakukan deployment ke production.
    </div>

    <!-- Footer -->
    <div class="footer">
        <p><strong>Dokumentasi teknis ini memberikan panduan lengkap untuk memahami arsitektur, implementasi, dan operasional sistem KISS. Setiap bagian dirancang untuk memfasilitasi development, maintenance, dan scaling yang efektif.</strong></p>
        
        <hr style="margin: 30px 0; border: 1px solid #2ecc71;">
        
        <p><em>Â© 2024 MUKHSIN HADI, SE, M.Si, CGAA, CPFRM, CSEP, CRP, CPRM, CSCAP, CPABC</em><br>
        <em>aplikasiKISS@2024.Mukhsin Hadi. Hak Cipta dilindungi oleh Undang-Undang</em></p>
        
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
            <strong>Kontak dan Dukungan:</strong><br>
            ğŸ“§ support@kiss-app.com<br>
            ğŸŒ www.kiss-app.com<br>
            ğŸ“± http://wa.me/085726112001
        </div>
    </div>

</body>
</html>