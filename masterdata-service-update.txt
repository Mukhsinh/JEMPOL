// Update getPatientTypes function untuk handle error 403 dengan lebih baik
export const getPatientTypes = async (): Promise<PatientType[]> => {
  try {
    console.log('üîç Fetching patient types...');
    
    // Try primary endpoint first
    const response = await api.get('/master-data/patient-types');
    console.log('‚úÖ Primary endpoint success:', response.data?.length || 0, 'records');
    return response.data || [];
    
  } catch (error: any) {
    console.warn('‚ö†Ô∏è  Primary endpoint failed:', error.message);
    
    // If 403 or 401, try public endpoint
    if (error.message.includes('403') || error.message.includes('401') || error.message.includes('Token tidak valid')) {
      try {
        console.log('üîÑ Trying public fallback endpoint...');
        const fallbackResponse = await api.get('/master-data/public/patient-types');
        console.log('‚úÖ Public fallback success:', fallbackResponse.data?.length || 0, 'records');
        return fallbackResponse.data || [];
      } catch (fallbackError: any) {
        console.error('‚ùå Public fallback also failed:', fallbackError.message);
      }
    }
    
    // Return default data if all else fails
    console.log('üîÑ Using default patient types data');
    return [
      {
        id: '1',
        name: 'Pasien Umum',
        code: 'UMUM',
        description: 'Pasien dengan layanan umum',
        priority_level: 3,
        default_sla_hours: 24,
        is_active: true,
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString()
      },
      {
        id: '2',
        name: 'Pasien VIP',
        code: 'VIP',
        description: 'Pasien dengan layanan VIP',
        priority_level: 2,
        default_sla_hours: 4,
        is_active: true,
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString()
      },
      {
        id: '3',
        name: 'Pasien Darurat',
        code: 'DARURAT',
        description: 'Pasien dengan kondisi darurat',
        priority_level: 1,
        default_sla_hours: 1,
        is_active: true,
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString()
      }
    ];
  }
};